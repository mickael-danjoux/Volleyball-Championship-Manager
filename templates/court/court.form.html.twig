{% extends 'base.html.twig' %}
{% block body %}
    <div class="col-md-5 mx-auto">
        <h4 class="text-center mb-4">{% if court.club.id is defined %}{{ court.club.name }} - {{ court.name }}{% else %}Ajouter un terrain{% endif %}</h4>
        <form method="POST">
            <input type="hidden" name="clubId" value="{% if court.club.id is defined %}{{ court.club.id }}{% endif %}">
            <input type="hidden" name="courtId" value="{% if court.id is defined %}{{ court.id }}{% endif %}">
            <div class="form-group">
                <label for="inputCourtPlace">Lieu</label>
                <input class="form-control" id="inputCourtPlace" type="text" name="courtPlace" value="{% if court.id is defined %}{{ court.place }}{% endif %}" required/>
            </div>
            <div class="form-group">
                <label for="inputTimeSlot">Créneau(x) :</label><br/>
                De
                <input class="form-control col-md-2 d-inline" id="inputTimeSlotStartTime" type="time" name="timeSlotStartTime" />
                À
                <input class="form-control col-md-2 d-inline" id="inputTimeSlotEndTime" type="time" name="timeSlotEndTime" />
                <button type="button" class="btn btn-primary addTimeSlot">Ajouter</button>
                <ul id="timeSlots">
                {% if court.timeSlots is defined %}
                    {% for timeslot in court.timeSlots %}
                        <li>
                            De
                            <input class="form-control col-md-3 d-inline timeSlotStartTime" type="text" name="timeSlotStartTime" value="{{ timeslot.startTime }}" disabled/>
                            À
                            <input class="form-control col-md-3 d-inline timeSlotEndTime" type="text" name="timeSlotEndTime" value="{{ timeslot.startEnd }}" disabled/>
                            <button type="button" class="btn btn-outline-primary deleteTimeSlot">Supprimer</button>
                        </li>
                    {% endfor %}
                {% endif %}
                </ul>
            </div>
            <div class="w-100 text-right">
                <input class="btn btn-primary saveCourt" type="button" value="Enregistrer"/>
            </div>
        </form>
    </div>
{% endblock %}
{% block javascripts %}
    <script>
    $(document).ready(function(){
        var startTimes = $('.timeSlotStartTime');
        var endTimes = $('.timeSlotEndTime');
        var startTime = parseInt($('#inputTimeSlotStartTime').val().replace(':', ''));
        var endTime = parseInt($('#inputTimeSlotEndTime').val().replace(':', ''));
        $(document).on('click', '.addTimeSlot', function(){
            var alreadyExist = false;

            if (startTime >= endTime || isNaN(startTime) || isNaN(endTime)) {
                alreadyExist = true;
            }

            startTimes.get().forEach(function(s, i){
                endTimes.get().forEach(function(e) {
                    let intS = parseInt(s.value.replace(':', ''));
                    let intE = parseInt(e.value.replace(':', ''));
                    if (startTime > intS && startTime < intE || endTime > intS && endTime < intE || startTime <= intS && endTime >= intE) {
                        alreadyExist = true;
                    }
                });
            });

            if (alreadyExist) {
                alert("Créneau incorrect.");
            } else {
                $('#timeSlots').append('<li>' +
                    'De\n' +
                    '<input class="form-control col-md-2 d-inline timeSlotStartTime" type="text" name="timeSlotStartTime" value="' + $('#inputTimeSlotStartTime').val() + '" disabled/>\n' +
                    'À\n' +
                    '<input class="form-control col-md-2 d-inline timeSlotEndTime" type="text" name="timeSlotEndTime" value="' + $('#inputTimeSlotEndTime').val() + '" disabled/>\n' +
                    '<button type="button" class="btn btn-outline-primary deleteTimeSlot">Supprimer</button>' +
                    '</li>');
            }
        });

        $(document).on('click', '.deleteTimeSlot', function(){
            $(this).parent().remove();
        });

        $(document).on('click', '.saveCourt', function(){
            startTimes.get().forEach(function(s, i, a) {
                console.log(a);
            });
            /*$.post(
                "court/form",
                {
                    courtPlace:$('#inputCourtPlace').val(),

                }

            )*/
        });
    });
    </script>
{% endblock %}